<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Pembayaran</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <script src="https://app.sandbox.midtrans.com/snap/snap.js"
    data-client-key="Mid-client-fvOCSkh7us8t74ZF"></script>

</head>
<body style="font-family: sans-serif;">

<script>
  const url = new URLSearchParams(window.location.search);
  const token = url.get("token");

  // Jika tidak ada token → keluar
  if (!token) {
    document.body.innerHTML = "Token tidak valid.";
  }

  // Jalankan Snap
  snap.pay(token, {

    onClose: function() {

      // Kirim status ke backend → diberi status CLOSED
      fetch("https://oleh2inpos-backend.onrender.com/payment-status", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token, status: "closed" })
      });

      // Redirect halaman supaya TIDAK stuck
      window.location.href = "about:blank";
    }

  });

  snap.pay(token, {

  onSuccess: function(result) {
    fetch("https://oleh2inpos-backend.onrender.com/payment-status", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ token, status: "success", result })
    });

    // Tutup halaman HP setelah kirim sukses
    window.location.href = "about:blank";
  },

  onClose: function() {
    fetch("https://oleh2inpos-backend.onrender.com/payment-status", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ token, status: "closed" })
    });

    window.location.href = "about:blank";
  }
});

</script>

<p style="text-align:center">Sedang membuka pembayaran Midtrans...</p>

</body>
</html>


